<section class="crud-card colegio-card">
  <div class="crud-card__header">
    <div class="crud-card__title">
      <span aria-hidden="true" class="crud-card__icon">🏫</span>
      <div>
        <h2>Colegios</h2>
        <p>Gestiona los colegios y sus estudiantes vinculados.</p>
      </div>
    </div>
    <div class="crud-card__actions">
      <button type="button" class="btn btn-primary" (click)="loadColegios()" [disabled]="loading()">
        Consultar
      </button>
    </div>
  </div>

  <div class="crud-card__body">
    <form class="crud-form crud-form--inline" [formGroup]="createForm" (ngSubmit)="createColegio()">
      <div class="crud-field">
        <label class="visually-hidden" for="colegio-create-nombre">Nombre del colegio</label>
        <input
          id="colegio-create-nombre"
          type="text"
          formControlName="nombre"
          placeholder="Nombre del colegio"
        />
      </div>
      <div class="crud-field">
        <label class="visually-hidden" for="colegio-create-max">Capacidad total</label>
        <input
          id="colegio-create-max"
          type="number"
          formControlName="maxEstudiantes"
          placeholder="Capacidad de estudiantes"
        />
      </div>
      <button type="submit" class="btn btn-primary" [disabled]="createForm.invalid || loading()">
        Guardar Colegio
      </button>
    </form>

    <div class="utility-forms">
      <form class="crud-form crud-form--inline" [formGroup]="searchForm" (ngSubmit)="searchColegio()">
        <div class="crud-field">
          <label class="visually-hidden" for="colegio-search-id">Buscar colegio por código</label>
          <input id="colegio-search-id" type="number" formControlName="id" placeholder="Código para buscar" />
        </div>
        <button type="submit" class="btn btn-flat" [disabled]="searchForm.invalid || loading()">
          Buscar
        </button>
      </form>

      <form class="crud-form crud-form--inline" [formGroup]="updateForm" (ngSubmit)="updateColegio()">
        <div class="crud-field">
          <label class="visually-hidden" for="colegio-update-id">Código del colegio</label>
          <input id="colegio-update-id" type="number" formControlName="id" placeholder="Código del colegio" />
        </div>
        <div class="crud-field">
          <label class="visually-hidden" for="colegio-update-nombre">Nombre</label>
          <input id="colegio-update-nombre" type="text" formControlName="nombre" placeholder="Nuevo nombre" />
        </div>
        <div class="crud-field">
          <label class="visually-hidden" for="colegio-update-max">Capacidad total</label>
          <input
            id="colegio-update-max"
            type="number"
            formControlName="maxEstudiantes"
            placeholder="Capacidad de estudiantes"
          />
        </div>
        <button type="submit" class="btn btn-flat" [disabled]="updateForm.invalid || loading()">
          Actualizar
        </button>
      </form>

      <form class="crud-form crud-form--inline" [formGroup]="deleteForm" (ngSubmit)="deleteColegio()">
        <div class="crud-field">
          <label class="visually-hidden" for="colegio-delete-id">Código a eliminar</label>
          <input id="colegio-delete-id" type="number" formControlName="id" placeholder="Código para eliminar" />
        </div>
        <button type="submit" class="btn btn-flat" [disabled]="deleteForm.invalid || loading()">
          Eliminar
        </button>
      </form>
    </div>
  </div>

  <div class="table-wrapper" *ngIf="colegios().length > 0; else emptyColegioList">
    <table class="data-table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Capacidad</th>
          <th>Estudiantes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let colegio of colegios()">
          <td>{{ colegio.nombre }}</td>
          <td>{{ colegio.maxEstudiantes }}</td>
          <td>
            <ng-container *ngIf="colegio.estudiantes.length > 0; else withoutStudents">
              <ul class="badge-list">
                <li *ngFor="let alumno of colegio.estudiantes">{{ alumno.nombre }}</li>
              </ul>
            </ng-container>
            <ng-template #withoutStudents>
              <span class="no-data">Sin estudiantes asociados</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <ng-template #emptyColegioList>
    <div class="empty-state">Consulta para ver los colegios registrados.</div>
  </ng-template>

  <div class="selected-block" *ngIf="selectedColegio() as colegio">
    <h3>Colegio consultado</h3>
    <p class="selected-name">{{ colegio.nombre }}</p>
    <p class="selected-meta">Capacidad total: {{ colegio.maxEstudiantes }}</p>
    <ng-container *ngIf="colegio.estudiantes.length > 0">
      <h4>Estudiantes asociados</h4>
      <ul class="badge-list">
        <li *ngFor="let alumno of colegio.estudiantes">{{ alumno.nombre }}</li>
      </ul>
    </ng-container>
  </div>

  @if (lastMessage()) {
    <p class="status-message">{{ lastMessage() }}</p>
  }
</section>
